# Zählt × 平交道咖啡｜Pro友俱樂部 PRD（需求凍結版）

> 版本：v1.0（凍結）｜日期：2025-12-31  
> 對應文件：`docs/pro-club-dev-plan.md`

---

### 1) 產品目標與成功指標

- **目標**：將「官網內容 → 加入會員 → 消費/活動/電商 → 點數與等級 → 現場核銷 → 推播再行銷 → 報表」串成可營運閉環，並支援 **業務 QR 歸因與分潤結算**。
- **首日成功（MVO）**：會員可用、現場可掃、後台可管、交易可稽核、分潤可追溯、電商可完成「下單→付款→出貨」。
- **建議 KPI（首月）**
  - 會員新增數、登入轉換率（訪客→會員）
  - 活動報名率/出席率、核銷成功率
  - 電商：付款成功率、平均客單、退款率
  - 點數：發放/使用/逾期比例
  - 推播：送達率/點擊率（依渠道可得）
  - 分潤：可結算金額、回沖筆數

---

### 2) 角色與權限（RBAC）

- **訪客**：瀏覽官網/活動/型錄、加入 LINE、（可）直接購買
- **會員**：LINE/Email 登入、會員卡 QR、點數/等級、活動報名、訂單查詢
- **Staff（店員/活動人員）**：掃碼報到/兌換/權益核銷、必要查詢（最小可見）
- **Admin（管理員）**：內容/會員/點數/活動/電商/推播/分潤/報表全權與稽核
- **Sales（業務/推廣者）**：個人 QR/連結、查看自身歸因/分潤報表

---

### 3) 首日功能範圍（In Scope）

#### 3.1 前台

- **官網內容（CMS）**：品牌、服務、案例、活動頁、花絮、Link Hub
- **電子型錄/檔案中心**：瀏覽/下載/分享、一鍵轉傳、可置入外部連結、支援 LINE 內開啟
- **會員中心**
  - 登入：**LINE + Email（LINE 為主）**
  - 會員資料：**必填：姓名/手機/Email**；可選：生日/車種車牌/地址/其他自訂欄位
  - 會員卡：顯示會員 QR（供查詢/核銷/報到）
  - 等級：Bronze/Silver/Gold（**自動升級**，顯示進度與權益）
  - 點數：累積、折抵/兌換、明細查詢
  - 活動：報名、提醒、報到核銷狀態
  - 訂單：查詢（電商）
- **業務歸因入口（Sales QR/連結）**
  - 產生專屬連結與 QR
  - 支援導向：加入會員、購買、（可）活動付費
  - 歸因：**last-touch**、有效期 **7 天**
- **電商購物（訪客可直接購買）**（首日包含）
  - 訪客可不登入直接下單/付款/出貨（仍需提供必要收件資訊）
  - 訂單查詢：
    - 會員：登入後於會員中心查詢
    - 訪客：支援以 **`order_number + email`** 查詢訂單（不需登入）[[memory:12722575]]
  -（可調整）點數/等級策略：
    - 預設：訪客下單不立即累點；若後續以同 Email 完成會員登入/驗證，可將訂單歸戶並補點（需可稽核）

#### 3.2 後台

- **CRM 會員管理**：會員資料、標籤/分群、等級、點數、活動/交易紀錄
- **點數後台**：規則設定、人工調整、稽核流水、兌換品/券管理、匯出
- **活動後台**：活動建立、名額、報名名單、報到/核銷、出席率統計
- **推播**：依等級/標籤/條件分群，主要渠道 **LINE**（Email 作為備援/輔助）
- **電商後台**：商品/SKU/庫存/價格/會員價、訂單/出貨/付款狀態
- **分潤後台**：Sales 管理、QR 生成、分潤規則（依品項）、流水、結算報表、回沖
- **報表**：會員、點數、活動、電商、分潤（營運必需指標）

---

### 4) 非首日範圍（Out of Scope / 延後）

- **廣告位模組**：先列為 Milestone 6（可延後）
- **電子發票/物流串接**：首日先完成「下單→付款→出貨」閉環；發票/物流在申請/串接就緒後快速補上
- 進階行為追蹤（例如全站事件追蹤/熱圖）除非另行確認

---

### 5) 關鍵規則（凍結）

#### 5.1 帳號綁定/合併

- **允許合併**：用戶可在登入狀態下自行把 LINE 與 Email 綁定為同一會員
- **安全要求**
  - Email 必須完成驗證（驗證碼/驗證信）
  - 綁定/解綁寫入 audit log（時間、IP/裝置識別*若可得*、操作者）

#### 5.2 等級（Bronze/Silver/Gold）

- **升級**：自動升級（依門檻規則）
- **權益核銷**：支援 **QR 核銷**與**後台手動標記**兩種

#### 5.3 點數

- **折抵範圍**：飲品/活動費用/服務費施工費/廣告位/電商商品（方向：皆可能）
- **折抵上限**：可調整參數（% 與/或固定金額）
- **兌換型態**：抵用金券 + 商品（兩者都有）
- **有效期/延長條件**：可調整參數，可勾選哪些「消費類型」視為延長觸發
- **稽核**：點數必須以流水（append-only）記錄，每一筆需可追溯原因與參照來源
  -（補充）訪客訂單若後續歸戶補點，需以流水方式記錄 `ref_type=ORDER` 並標註 `reason_code=CLAIM_ORDER_EARN`

#### 5.4 活動

- 活動可設定 **免費/付費**；若付費，預設 **付款成功才算報名成功**（可調整）
- **候補**：可調整開關；候補轉正通知可選 **LINE / Email**

#### 5.5 分潤（Sales）

- **歸因**：last-touch；有效期 7 天
- **成立時點**：**服務完成才成立**
- **退款/取消**：自動回沖（分潤與報表）
- **分潤規則**：依不同品項不同規則（可配置）
- **會員綁定更換**：允許，建議冷卻期 30 天（可調整參數）

---

### 6) 狀態機（概要）

> 詳細狀態機請見：`docs/pro-club-flows-and-state-machines.md`

- 訂單：CREATED → UNPAID → PAID → FULFILLING → SHIPPED → COMPLETED（含 CANCELLED/REFUNDED/FAILED）
- 活動報名：REGISTERED →（若付費）PAID → CHECKED_IN / CANCELLED / WAITLIST
- 兌換：ISSUED → REDEEMED / VOID
- 分潤：PENDING → ELIGIBLE（服務完成）→ PAID / REVERSED

---

### 7) 非功能需求（NFR）

- **使用者體驗（UX）— 必須以使用者角度設計（硬性要求）**
  - 本專案所有前台/會員中心/後台/Staff 掃碼頁，皆以「**非工程背景使用者能直覺完成任務**」為優先；禁止為了工程實作方便而犧牲流程可理解性。
  - **行動裝置優先**：會員中心、型錄、掃碼核銷必須以手機體驗為主（字級、點擊區、單手操作、低光環境可讀性）。
  - **任務導向**：每個頁面要能明確回答使用者「我現在能做什麼、下一步是什麼、完成後會得到什麼」。
  - **狀態可見**：所有非即時操作需有 loading/disabled/進度提示；完成需有成功回饋（含下一步 CTA）。
  - **錯誤可理解**：錯誤訊息必須「人話」+ 可行的解法；不得只顯示代碼或泛用錯誤。
  - **防呆與可復原**：重要操作（核銷、退款、調整點數）需二次確認與可追溯；避免誤觸造成不可逆結果。
  - **一致性**：文案、狀態名稱、按鈕位置、表單驗證規則需一致（與 `docs/pro-club-flows-and-state-machines.md`、`docs/pro-club-api-spec.md` 同步）。
  - **可用性基線**：核心旅程（加入/報名/付款/核銷/查點數）在一般網路環境下需可順暢完成；避免多餘跳轉與不必要填寫。

- **安全**
  - QR 核銷 token 一次性 + 有效期 + 防重放
  - 權限最小化；敏感資料加遮罩（Staff 端）
- **稽核**
  - 點數、核銷、分潤、付款皆需 audit trail；可匯出
- **可靠性**
  - 金流 callback 重送/重放要能冪等處理
  - 任何「狀態改變」都需記錄來源事件與時間戳
- **可維運**
  - 後台需支援查詢/篩選/匯出；異常可人工修正且留紀錄

